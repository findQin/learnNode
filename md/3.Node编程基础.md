# 3. Node编程基础
> 用模块组织代码
> 编码规范
> 用回调处理一次性完结的事件
> 用事件发射器处理重复性事件
> 实现串行和并行流控制
> 使用流程控制工具

## 3.1 Node功能组织及重用
  - 程序通过require引入模块
  - 模块使用module.exports或exports导出
### 3.1.1 
创建模块
  * require是同步操作，一般放在文件头部，同步有助于保持代码整洁有序
  * require引入js文件可以不加.js后缀
### 3.1.2 
用module.exports微调模块的创建
  * 模块最终导出的是module.exports，exports指向module.exports
  * 直接设置exports=Obj会导致导出错误
### 3.1.3 
用node_modules重用模块
  * 模块目录中定义文件必须命名为index.js，否则需要额外package.json中main指定
### 3.1.4 
注意事项
  * 如果模块是目录，模块目录定义的文件必须命名为index.js，否则需要额外指定
  * Node会将模块缓存起来，如果两个文件引入相同模块，则第二次不会再访问源文件。这也有机会修改缓存的数据（即猴子补丁），让一个模块可以改变另一个模块的行为。

## 3.2 异步编程技术
回调：用来定义一次响应的逻辑
事件监听器：本质上也是一个回调，不同的是，它跟一个概念实体（事件）相关联
### 3.2.1
用回调处理一次性事件
[Code]chapter3 3.2.1
### 3.2.2
用事件发射器处理重复性事件
[Code]chapter3 3.2.2
**1. 事件发射器示例**
使用on响应事件
**2. 响应应该只发射一次的事件**
使用once响应
**3. 创建事件发射器PUB/SUB**
EventEmitter.on emit
**4. 扩展事件监听器: 文件监听器**
### 3.2.3 异步开发的难题
Node事件轮询会跟踪还没有完成的异步，只要有未完成的异步逻辑，Node进程就不会退出
- 程序的变量可能出现意想不到的变化（可以使用匿名函数保留全局变量的值）

## 3.3 异步逻辑的顺序化
让一组异步任务执行的概念被Node社区称为流程控制，这种控制分为两类：串行和并行
> 本节包含以下内容
> - 何时使用串行化流程控制
> - 如何实现串行化流程
> - 如何实现并行化流程控制
> - 如何使用第三方模块做流程控制
### 3.3.1 什么时候使用串行流程控制
可以使用回调让几个异步任务按顺序执行，但是如果任务很多必须组织一下，否则过多的回调嵌套会把代码高的很乱
[Code] 3.3.1 使用社区工具Nimble可以实现流程控制
### 3.3.2 实现串行化流程控制
[Code] 3.3.1 random_story.js
### 3.3.3 实现并行化流程控制
[Code] 3.3.1 word_count.js
### 3.3.4 利用社区里的工具
``` js
var flow = require('nimble');
flow.series([]) // 串行任务
flow.parallel([]) // 并行任务
```

## 3.4 本章小结
本章介绍了如何将程序的逻辑组织成可重用的模块，以及如何让异步逻辑按照你想要的方式执行
- Node模块系统基于CommonJS模块规范，你可以通过组装exports或module.exports轻松重用模块
- 可以在回调、事件发射器和流程控制管理异步逻辑，回调适用于一次异步逻辑，但使用注意别把代码搞乱；事件发射器对组织异步逻辑很有帮助，因为他们可以吧异步逻辑跟一个概念实体关系起来，可以通过监听器轻松管理
- 流程控制可以管理异步任务的执行顺序，可以让他们一个一个执行，也可以同时执行，可以自行解决这个问题也可以通过社区模块来解决
